<!-- Copyright (c) 2010 BSI Business Systems Integration AG. All rights reserved.
	This program and the accompanying materials are made available under the
	terms of the Eclipse Public License v1.0 which accompanies this distribution,
	and is available at http://www.eclipse.org/legal/epl-v10.html Contributors:
	BSI Business Systems Integration AG - initial API and implementation -->

<!--
	expecting properties:
	- downloadDir
		the directory to download the eclipse and delta pack to. The download only occures if the two files do not exist.
	- templateDir
		the directory contains a dropins folder with some bundles or features.
	- eclipseFileName
		the name of the eclipse file to download e.g. eclipse-SDK-3.7M3-win32.zip

	- eclipseDownloadUrl
		the url to download the eclipse e.g. http://download.eclipse.org/eclipse/downloads/drops/S-3.7M3-201010281441/${eclipseFileName}
	- eclipseDeltapackName
		the eclipse delta pack file name e.g. eclipse-3.7M3-delta-pack.zip
	- eclipseDeltapackUrl
		the url to download the delta pack e.g. http://download.eclipse.org/eclipse/downloads/drops/S-3.7M3-201010281441/${eclipseDeltapackName}

	 -->
<project name="setupEclipse" default="">
	<property environment="env" />
	<property file="build.properties" />

	<target name="setupEclipse" depends="downloadEclipse, downloadRapEclipse, downloadAllDropins">
		<!-- setup eclipse to the ${workingDir} -->
		<!-- unzip eclipse and delta pack and copy all dropins -->
		<delete dir="${workingDir}/eclipse" />
		<unzip dest="${workingDir}" overwrite="true" src="${downloadDir}/${eclipseFileName}" />
		<unzip dest="${workingDir}" overwrite="true" src="${downloadDir}/${eclipseDeltapackName}" />
		<copy todir="${workingDir}/eclipse/plugins" overwrite="true" failonerror="false">
			<fileset dir="${templateDir}/dropins/eclipse/plugins"
				includes="${orbitJarPattern}"
			/>
		</copy>
	</target>

	<target name="downloadAllDropins">
		<property name="pluginsDir" value="${templateDir}/dropins/eclipse/plugins" />
		<echo>Downloading dropins</echo>
		<mkdir dir="${pluginsDir}"/>
		<for list="${orbitDownloadPluginList}" param="plugin">
			<sequential>
				<antcall target="downloadIfNotAvailable">
					<param name="downloadFileDir" value="${pluginsDir}" />
					<param name="downloadFileDest" value="@{plugin}" />
					<param name="downloadFileSrc" value="${orbitDropUrl}/@{plugin}" />
				</antcall>
			</sequential>
		</for>
		<echo>Downloading packed dropins</echo>
		<for list="${orbitDownloadPackList}" param="plugin">
			<sequential>
				<antcall target="downloadIfNotAvailable">
					<param name="downloadFileDir" value="${pluginsDir}" />
					<param name="downloadFileDest" value="@{plugin}" />
					<param name="downloadFileSrc" value="${orbitDropUrl}/@{plugin}" />
				</antcall>
			</sequential>
		</for>
	</target>

	<target name="test">
		<property name="eclipseFileName" value="${3.5_eclipseFileName}"> </property>
		<property name="eclipseDownloadUrl" value="${3.5_eclipseDownloadUrl}"> </property>
		<echo>${downloadDir}</echo>
		<echo>${downloadDir}/${eclipseFileName}</echo>

		<antcall target="downloadIfNotAvailable" >
			<param name="downloadFileDir" value="${downloadDir}" />
			<param name="downloadFileName" value="${eclipseFileName}" />
			<param name="downloadFileSrc" value="${eclipseDownloadUrl}" />
		</antcall>
	</target>

	<target name="downloadEclipse">
		<!-- eclipse zip-->
		<antcall target="downloadIfNotAvailable">
			<param name="downloadFileDir" value="${downloadDir}" />
			<param name="downloadFileDest" value="${eclipseFileName}" />
			<param name="downloadFileSrc" value="${eclipseDownloadUrl}" />
		</antcall>
		<!-- eclipse delta pack-->
		<antcall target="downloadIfNotAvailable">
			<param name="downloadFileDir" value="${downloadDir}" />
			<param name="downloadFileDest" value="${eclipseDeltapackName}" />
			<param name="downloadFileSrc" value="${eclipseDeltapackUrl}" />
		</antcall>
		<!-- test framework-->
		<antcall target="downloadIfNotAvailable">
			<param name="downloadFileDir" value="${downloadDir}" />
			<param name="downloadFileDest" value="${eclipseTestFrameworkName}" />
			<param name="downloadFileSrc" value="${eclipseTestFrameworkUrl}" />
		</antcall>
	</target>

	<target name="downloadRapEclipse" >
		<!-- rap eclipse -->
		<antcall target="downloadIfNotAvailable">
			<param name="downloadFileDir" value="${downloadDir}" />
			<param name="downloadFileDest" value="${eclipseRapFileName}" />
			<param name="downloadFileSrc" value="${eclipseRapDownloadUrl}" />
		</antcall>
	</target>

	<target name="downloadIfNotAvailable"  depends="checkFileAvailable" unless="skipDownload" >
		<mkdir dir="${downloadFileDir}" />
		<get src="${downloadFileSrc}" dest="${downloadFileDir}/${downloadFileDest}" />
	</target>

	<target name="checkFileAvailable">
		<available file="${downloadFileDir}/${downloadFileDest}" property="skipDownload"/>
	</target>

</project>