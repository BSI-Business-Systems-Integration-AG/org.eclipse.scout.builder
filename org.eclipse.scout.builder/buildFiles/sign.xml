<!-- Copyright (c) 2010 BSI Business Systems Integration AG. All rights reserved. 
	This program and the accompanying materials are made available under the 
	terms of the Eclipse Public License v1.0 which accompanies this distribution, 
	and is available at http://www.eclipse.org/legal/epl-v10.html Contributors: 
	BSI Business Systems Integration AG - initial API and implementation -->

<project name="org.eclipse.scout.builder.sign" >
	<property environment="env" />
	
	<target name="setup">
		<delete dir="${signInputFolder}"/>
		<delete dir="${signOutputFolder}"/>
		<mkdir dir="${signInputFolder}"/>
		<mkdir dir="${signOutputFolder}"/>
	</target>
	
	<target name="signAndWaitResult">
		<available file="/home/data/httpd/download.eclipse.org/scout/updates" property="foundScout" />
		<echo message="found scout ${foundScout}"/>
		<echo message="start signing..." />
		<antcall target="startSign"/>
		<antcall target="checkSignedOutput" />
		<echo message="done signing..." />
	</target>

	<target name="checkSignedOutput" unless="stopSleep">
		<echo message="check file existance in ${buildWorkspace}"/>
		<available file="${signOutputFolder}/sign.zip" property="stopSleep" />
		<antcall target="waitForBetterTimes" />
	</target>

	<target name="waitForBetterTimes">
		<sleep seconds="15" />
		<antcall target="checkSignedOutput" />
	</target>


	<target name="startSign" unless="skipSign">
		<exec executable="sign" dir="${workingDir}/sign">
		    <arg value="${signInputFolder}/sign.zip"/>
			<arg value="nomail"/>
			<arg value="${signOutputFolder}"/>
		</exec>
	</target>

	<target name="testSign" depends="setup">
		<property name="" value=""></property>
		<copy todir="${signInputFolder}">
			<fileset dir="${templateDir}/sign" >
				<include name="*.zip"/>
			</fileset>
		</copy>
		<antcall target="signAndWaitResult"/>
	</target>
	
</project>